{% extends 'base.html' %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px; margin: 0 auto;">
    <h1>{{ article.title }}</h1>
    
    <div class="meta" style="margin: 15px 0; color: #666; font-size: 0.95em;">
        <span>Автор: {{ article.author.name }}</span> <br>
        <span>Категория: {{ article.category }}</span> <br>
        <span>Дата: {{ article.created_date | russian_date }}</span>
    </div>

    <div class="article-text" style="line-height: 1.7; margin-top: 20px;">
        {{ article.text }}
    </div>

    <a href="{{ url_for('articles') }}" style="display: inline-block; margin-top: 20px; color: #007bff; text-decoration: none;">
        ← Вернуться к списку статей
    </a>
    
    {% if current_user.is_authenticated and current_user == article.author %}
    <div style="margin-top: 20px;">
        <a href="{{ url_for('edit_article', id=article.id) }}" class="btn btn-warning">Редактировать</a>
        
        <form method="post" action="{{ url_for('delete_article', id=article.id) }}" 
              style="display: inline;" 
              onsubmit="return confirm('Вы уверены, что хотите удалить статью?');">
            <button type="submit" class="btn btn-danger">Удалить</button>
        </form>
    </div>
    {% endif %}
    
    {% if current_user.is_authenticated %}
    <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
        <h3>Оставить комментарий</h3>
        <form method="post">
            <div style="margin-bottom: 10px;">
                <input type="text" name="author_name" placeholder="Ваше имя"  class="form-control" required>
            </div>
            <div style="margin-bottom: 10px;">
                <textarea name="text" rows="4" placeholder="Текст комментария"  class="form-control" required></textarea>
            </div>
            <button type="submit" style="padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer;">
                Отправить
            </button>
        </form>
    </div>
    {% endif %}

    <!-- Список комментариев -->
    <div style="margin-top: 40px;">
        <h3>Комментарии ({{ comments|length }})</h3>
        {% if comments %}
            {% for comment in comments %}
            <div style="margin-top: 15px; padding: 10px; background: #f9f9f9; border-radius: 6px;">
                <div style="font-weight: bold; color: #333;">{{ comment.author_name }}</div>
                <div style="font-size: 0.9em; color: #777; margin: 5px 0;">
                    {{ comment.created_date | russian_date }}
                </div>
                <div style="margin-top: 8px;">{{ comment.text | safe }}</div>
            </div>
            {% endfor %}
        {% else %}
            <p>Пока нет комментариев.</p>
        {% endif %}
    </div>

    <a href="{{ url_for('index') }}" style="display: inline-block; margin-top: 20px; color: #007bff; text-decoration: none;">
        ← Вернуться к списку статей
    </a>
</div>
{% endblock %}